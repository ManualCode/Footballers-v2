@model List<Footballer>

<table>
    <thead>
        <tr>
            <td>Имя</td>
            <td>Фамилия</td>
            <td>Пол</td>
            <td>Дата рождения</td>
            <td>Команда</td>
            <td>Страна</td>
            <td></td>
        </tr>
    </thead>
    <tbody id="tbody-of-footballers">
        @foreach (var footballer in Model)
        {
            <tr id="@footballer.Id">
                <td>@footballer.FirstName</td>
                <td>@footballer.LastName</td>
                <td>@footballer.Gender</td>
                <td>@footballer.Birthday</td>
                <td>@footballer.TeamName</td>
                <td>@footballer.Country</td>
                <td><a class="btn btn-primary" href="/footballers/edit/@footballer.Id">Править</a></td>
            </tr>
        }
    </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
<script>
    const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl("/football")
        .build();

    hubConnection.start()
        .then(function () {
            console.log('Connection started');
        })
        .catch(function (err) {
            return console.error(err.toString());
        });

    hubConnection.on("Receive", function (footballer) {
        footballer.birthday = footballer.birthday.split('-').reverse().join('.')
        let val = Object.values(footballer);
        let tr = document.createElement("tr");
        tr.id = footballer.id
          for (let index = 1; index < val.length; ++index) {
            let td = document.createElement("td");
            td.textContent = val[index];
            tr.appendChild(td);
        }
        let td_button = document.createElement("td");
        let a_button = document.createElement("a");
        a_button.className = "btn btn-primary";
        a_button.href = `/footballers/edit/${footballer.id}`;
        a_button.textContent = "Править";
        td_button.appendChild(a_button);
        tr.appendChild(td_button);
        document.getElementById("tbody-of-footballers").appendChild(tr);
    });

    hubConnection.on("ReceiveEdit", function (footballer) {
        footballer.birthday = footballer.birthday.split('-').reverse().join('.')
        let val = Object.values(footballer);
        let tr = document.createElement("tr");
        tr.id = footballer.id
        for (let index = 1; index < val.length; ++index) {
            let td = document.createElement("td");
            td.textContent = val[index];
            tr.appendChild(td);
        }
        let td_button = document.createElement("td");
        let a_button = document.createElement("a");
        a_button.className = "btn btn-primary";
        a_button.href = `/footballers/edit/${footballer.id}`;
        a_button.textContent = "Править";
        td_button.appendChild(a_button);
        tr.appendChild(td_button);

        document.getElementById(footballer.id).replaceWith(tr);
    });

    hubConnection.on("ReceiveDelete", function (id) {
        document.getElementById(id).remove();
    });
</script>


